<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEY SONGBOOK // VIBE</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        /* [1] í™í•œ ë‹¤í¬ ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ í…Œë§ˆ ë³€ìˆ˜ */
        :root { 
            --bg: #0f172a; --card: rgba(30, 41, 59, 0.7); --text: #f1f5f9; --sub: #94a3b8; --line: rgba(255,255,255,0.1);
            --input-bg: rgba(15, 23, 42, 0.8); --primary: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); 
            --accent: #818cf8; --shadow: rgba(0, 0, 0, 0.4);
        }
        [data-theme="light"] {
            --bg: #f8fafc; --card: rgba(255, 255, 255, 0.8); --text: #1e293b; --sub: #64748b; --line: #e2e8f0;
            --input-bg: #ffffff; --primary: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); 
            --accent: #6366f1; --shadow: rgba(0, 0, 0, 0.05);
        }

        /* [2] ê¸°ë³¸ ë ˆì´ì•„ì›ƒ (ë ˆì´ì•„ì›ƒ ë¶•ê´´ ë°©ì§€ ê³ ì •) */
        * { box-sizing: border-box; font-family: "Pretendard", sans-serif; -webkit-font-smoothing: antialiased; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 20px; min-height: 100vh; overflow-x: hidden; transition: 0.4s; }
        .container { max-width: 1400px; margin: 0 auto; visibility: hidden; } /* ë°ì´í„° ë¡œë“œ ì „ ìˆ¨ê¹€ */
        .top-notice { font-size: 12px; color: var(--sub); text-align: right; margin-bottom: 15px; font-weight: 500; letter-spacing: -0.5px; opacity: 0.8; }

        header { margin-bottom: 40px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        .title-area h1 { margin: 0; font-size: 32px; font-weight: 900; background: var(--primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -1.5px; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ê·¸ë ˆì´ë“œ */
        .controls { display: flex; gap: 10px; align-items: center; }
        .icon-btn { width: 44px; height: 44px; background: var(--card); color: var(--text); border: 1px solid var(--line); border-radius: 14px; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); transition: 0.3s; }
        .icon-btn:hover { transform: translateY(-3px); border-color: var(--accent); box-shadow: 0 10px 20px var(--shadow); }
        .memo-btn { background: #fbbf24; color: #78350f; border: none; }
        
        .sns-link { display: flex; align-items: center; justify-content: center; width: 44px; height: 44px; border-radius: 14px; text-decoration: none; font-weight: 900; font-size: 11px; color: #fff; transition: 0.3s; }
        .soop-btn { background: #3b82f6; } .cafe-btn { background: #10b981; }
        .admin-toggle-btn { background: var(--card); color: var(--text); border: 1px solid var(--line); padding: 0 16px; height: 44px; border-radius: 14px; cursor: pointer; font-weight: 700; font-size: 13px; transition: 0.3s; }
        .admin-toggle-btn.active { background: #ef4444; color: white; border: none; }
        .add-btn { background: #6366f1; color: white; border: none; padding: 0 16px; height: 44px; border-radius: 14px; display: none; font-weight: 700; cursor: pointer; }

        .search-box { position: relative; width: 100%; }
        .search-input { width: 100%; padding: 18px 25px; background: var(--card); border: 1px solid var(--line); border-radius: 20px; color: var(--text); font-size: 16px; outline: none; backdrop-filter: blur(10px); transition: 0.3s; }
        .search-input:focus { border-color: var(--accent); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2); }

        /* [3] ì‚¬ì´ë“œë°” & ë ˆì´ì•„ì›ƒ */
        .main-layout { display: flex; gap: 40px; align-items: flex-start; }
        aside { width: 240px; flex-shrink: 0; position: sticky; top: 30px; }
        .side-card { background: var(--card); padding: 25px; border-radius: 24px; border: 1px solid var(--line); margin-bottom: 20px; backdrop-filter: blur(10px); text-align: center; }
        
        .random-btn { width: 100%; padding: 18px; border-radius: 18px; border: none; cursor: pointer; font-weight: 900; font-size: 16px; background: var(--primary); color: white; margin-bottom: 25px; box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4); transition: 0.3s; }
        .random-btn:hover { transform: scale(1.03) translateY(-3px); box-shadow: 0 15px 30px rgba(99, 102, 241, 0.6); }

        aside h3 { font-size: 11px; color: var(--sub); margin: 30px 0 12px 0; text-transform: uppercase; letter-spacing: 2px; font-weight: 800; border-bottom: 1px solid var(--line); padding-bottom: 8px; }
        .filter-list { max-height: 280px; overflow-y: auto; padding-right: 5px; }
        .filter-item { padding: 10px 12px; cursor: pointer; color: var(--sub); border-radius: 10px; transition: 0.2s; font-weight: 500; font-size: 14px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .filter-item:hover { background: rgba(255,255,255,0.05); color: var(--text); }
        .filter-item.active { background: var(--primary); color: white; font-weight: 800; }

        /* [4] ë…¸ë˜ ê·¸ë¦¬ë“œ (PC 5ì—´ / ëª¨ë°”ì¼ 2ì—´) */
        .song-grid { flex-grow: 1; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .song-card { background: var(--card); border-radius: 28px; overflow: hidden; border: 1px solid var(--line); position: relative; cursor: pointer; backdrop-filter: blur(10px); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .song-card:hover { transform: translateY(-12px); border-color: var(--accent); box-shadow: 0 20px 40px var(--shadow); }
        .song-card:hover .art-box img { transform: scale(1.1); }

        .edit-btn-group { display: none; position: absolute; top: 12px; right: 12px; gap: 6px; z-index: 10; }
        body.admin-mode .edit-btn-group { display: flex; }
        .edit-label { background: rgba(255,255,255,0.9); color: #0f172a; padding: 6px 12px; border-radius: 10px; font-size: 11px; font-weight: 800; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        .art-box { width: 100%; aspect-ratio: 1/1; background: #1e293b; overflow: hidden; }
        .art-box img { width: 100%; height: 100%; object-fit: cover; transition: 0.6s; }
        
        .info { padding: 22px; }
        .title-row { font-size: 15px; font-weight: 800; margin-bottom: 8px; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: var(--text); }
        
        /* ì¹´ë“œ í…ìŠ¤íŠ¸ ê²¹ì¹¨ í•´ê²° ì •ë ¬ */
        .sub-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; width: 100%; }
        .card-artist { color: var(--sub); font-size: 12px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; text-align: left; min-width: 0; }
        .badge-group { display: flex; align-items: center; gap: 4px; flex-shrink: 0; }
        .card-badge { font-size: 9px; padding: 4px 8px; border-radius: 6px; font-weight: 800; background: rgba(255,255,255,0.05); color: var(--sub); white-space: nowrap; border: 1px solid var(--line); }
        .bg-status { background: rgba(16, 185, 129, 0.2) !important; color: #10b981 !important; border: none; }

        /* [5] ìƒì„¸ ëª¨ë‹¬ ë° ê°€ì‚¬ ì‹œìŠ¤í…œ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center; padding: 15px; }
        .modal-content { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(30px); width: 100%; max-width: 1100px; border-radius: 40px; padding: 40px; display: grid; grid-template-columns: 350px 1fr; gap: 40px; position: relative; height: 85vh; overflow: hidden; border: 1px solid var(--line); box-shadow: 0 30px 60px rgba(0,0,0,0.5); }
        
        .lyrics-area { display: flex; flex-direction: column; gap: 20px; height: 100%; overflow: hidden; }
        .lyrics-display { background: rgba(0,0,0,0.3); border: 1px solid var(--line); padding: 40px; border-radius: 30px; flex: 1; overflow-y: auto; white-space: pre-wrap; line-height: 2.5; font-size: 20px; color: var(--text); font-weight: 600; text-align: center; }
        
        .lyrics-control { display: flex; align-items: center; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px 30px; border-radius: 25px; flex-shrink: 0; }
        .input-num { width: 60px; padding: 10px; text-align: center; border-radius: 12px; border: 1px solid var(--line); background: rgba(0,0,0,0.2); color: white; font-weight: 800; font-size: 15px; outline: none; }
        .p-btn { padding: 10px 20px; border-radius: 14px; border: none; cursor: pointer; font-weight: 700; background: transparent; color: var(--sub); font-size: 14px; transition: 0.3s; }
        .p-btn.active { background: var(--accent); color: white; box-shadow: 0 4px 15px rgba(129, 140, 248, 0.4); }

        .modal-btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: auto; flex-shrink: 0; }
        .link-btn { display: flex; align-items: center; justify-content: center; padding: 16px; text-align: center; border-radius: 20px; text-decoration: none; font-weight: 800; font-size: 14px; color: #fff; transition: 0.3s; box-shadow: 0 8px 15px var(--shadow); }
        .link-btn:hover { transform: translateY(-3px); filter: brightness(1.1); }
        .close-btn { position: absolute; top: 25px; right: 30px; background: none; border: none; color: var(--sub); font-size: 35px; cursor: pointer; transition: 0.3s; }
        .close-btn:hover { color: white; transform: rotate(90deg); }

        /* [6] ì»¤ìŠ¤í…€ ëª¨ë‹¬ íŒì—… & ë£°ë › */
        #customModalOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9500; align-items: center; justify-content: center; }
        .custom-modal-box { background: #1e293b; padding: 40px; border-radius: 30px; width: 90%; max-width: 450px; text-align: center; border: 1px solid var(--line); box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .custom-modal-title { font-size: 22px; font-weight: 900; margin-bottom: 15px; background: var(--primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .custom-modal-msg { font-size: 16px; color: var(--text); margin-bottom: 25px; line-height: 1.6; }
        .custom-modal-input { width: 100%; padding: 15px; margin-bottom: 20px; border: 1px solid var(--line); border-radius: 15px; background: rgba(0,0,0,0.2); color: white; font-size: 16px; outline: none; }
        .custom-modal-btn { padding: 14px 28px; border-radius: 15px; border: none; cursor: pointer; font-weight: 800; font-size: 15px; transition: 0.2s; }

        #rouletteOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.95); z-index: 8000; align-items: center; justify-content: center; flex-direction: column; color: white; }
        .roulette-card { width: 300px; height: 420px; background: white; border-radius: 40px; overflow: hidden; display: flex; flex-direction: column; align-items: center; padding: 25px; box-shadow: 0 0 50px rgba(99, 102, 241, 0.5); }
        .roulette-img { width: 250px; height: 250px; border-radius: 25px; object-fit: cover; margin-bottom: 20px; }

        /* [7] ëœë¤ ë½‘ê¸° í•„í„° ì¹© */
        .rand-list-wrapper { display: flex; flex-wrap: wrap; gap: 8px; max-height: 180px; overflow-y: auto; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 20px; border: 1px solid var(--line); }
        .rand-chip { padding: 10px 18px; border-radius: 12px; background: var(--card); border: 1px solid var(--line); font-size: 13px; cursor: pointer; font-weight: 600; color: var(--sub); transition: 0.2s; }
        .rand-chip.active { background: var(--primary); color: white; border-color: transparent; transform: scale(1.05); }

        /* [8] ê´€ë¦¬ì ì •ë³´ ê´€ë¦¬ */
        .admin-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center; padding: 20px; }
        .admin-modal { background: #1e293b; padding: 40px; border-radius: 40px; width: 100%; max-width: 800px; border: 1px solid var(--line); position: relative; max-height: 95vh; overflow-y: auto; box-shadow: 0 30px 60px rgba(0,0,0,0.5); }
        .status-btn { flex: 1; padding: 15px; background: rgba(255,255,255,0.05); border: 1px solid var(--line); color: var(--sub); border-radius: 15px; cursor: pointer; font-weight: 800; transition: 0.3s; }
        .status-btn.active { background: var(--accent) !important; color: white !important; border: none; box-shadow: 0 5px 15px rgba(129, 140, 248, 0.4); }
        .admin-modal textarea { width: 100%; padding: 25px; background: rgba(0,0,0,0.2); border: 1px solid var(--line); color: white; border-radius: 20px; margin-bottom: 25px; font-size: 15px; line-height: 1.8; resize: vertical; min-height: 400px; }

        /* [9] ë¡œë”© & ëª¨ë°”ì¼ ìµœì í™” */
        #pageLoader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; transition: 0.6s; }
        .spinner { width: 55px; height: 55px; border: 5px solid var(--line); border-top-color: #818cf8; border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 768px) {
            .main-layout { flex-direction: column; }
            aside { width: 100%; position: relative; top: 0; }
            .song-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            .modal-content { grid-template-columns: 1fr; padding: 25px; height: 95vh; }
            #modalSide { text-align: center; }
            .title-area h1 { font-size: 24px; }
        }

        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(20px); background: #1e293b; color: white; padding: 20px 35px; border-radius: 20px; font-weight: 700; z-index: 3000; border: 1px solid var(--accent); box-shadow: 0 15px 35px rgba(0,0,0,0.4); opacity: 0; visibility: hidden; transition: 0.4s; }
        .toast.show { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
        .p1 { color: #f1f5f9; } .p2 { color: #f87171; } .p3 { color: #60a5fa; } .p4 { color: #34d399; }
        footer { text-align: center; padding: 60px 20px; color: var(--sub); font-size: 12px; border-top: 1px solid var(--line); margin-top: 80px; letter-spacing: 1px; }
    </style>
</head>
<body data-theme="dark">
<div id="pageLoader">
    <div class="spinner"></div>
    <div style="font-size: 18px; font-weight: 900; color: var(--accent); letter-spacing: 1px;">LOADING TRACKS...</div>
</div>

<div class="container" id="mainContainer">
    <div class="top-notice">VIBE WITH JEY CATALOG // 2026 EDITION</div>
    <header>
        <div class="header-top">
            <div class="title-area"><h1 id="siteTitle">ì œì´ ë…¸ë˜ ëª©ë¡</h1></div>
            <div class="controls">
                <a href="https://www.sooplive.co.kr/station/qw794" target="_blank" class="sns-link soop-btn">SOOP</a>
                <a href="https://cafe.naver.com/jeykoreanfood" target="_blank" class="sns-link cafe-btn">CAFE</a>
                <button class="icon-btn memo-btn" onclick="handleMemoClick()">ğŸ“</button>
                <button class="icon-btn" onclick="cycleTheme()" id="themeCycleBtn">â˜€ï¸</button>
                <button class="admin-toggle-btn" onclick="toggleAdminMode()" id="adminToggle">ADMIN</button>
                <button class="add-btn" onclick="openAdmin()" id="addBtn">+ TRACK</button>
            </div>
        </div>
        <div class="search-box"><input type="text" id="searchInput" class="search-input" placeholder="ê³¡ëª…, ê°€ìˆ˜, ì¥ë¥´ë¥¼ ê²€ìƒ‰í•´ ë³´ì„¸ìš”..." oninput="handleSearch()"></div>
    </header>

    <div id="rouletteOverlay">
        <div style="font-size: 32px; font-weight: 900; margin-bottom: 30px; letter-spacing: -1px;">ğŸ² ë„¥ìŠ¤íŠ¸ íŠ¸ë™ì€...?</div>
        <div class="roulette-card">
            <img src="" id="rouletteImg" class="roulette-img" onerror="this.src='https://via.placeholder.com/250?text=No+Image'">
            <div id="rouletteTitle" style="color:#0f172a; font-size:22px; font-weight:900; text-align:center; width:100%; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">ê³¡ ì œëª©</div>
            <div id="rouletteArtist" style="color:#64748b; font-size:16px; margin-top:8px; font-weight:700;">ê°€ìˆ˜</div>
        </div>
    </div>

    <div id="randomFilterModal" class="modal" style="z-index: 6500;">
        <div class="modal-content" style="display: block; height: auto; max-height: 95vh; overflow-y: auto; max-width:580px;">
            <button class="close-btn" onclick="closeRandomModal()">Ã—</button>
            <div style="font-size:26px; font-weight:900; margin-bottom:30px; text-align:center; background: var(--primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">RANDOM PICKER</div>
            <div style="margin-bottom:25px; text-align:left;">
                <div style="font-size:12px; font-weight:800; color:var(--sub); margin-bottom:12px; letter-spacing:1px;">í‚¤ì›Œë“œ</div>
                <input type="text" id="randKeyword" class="search-input" style="padding: 12px 20px;" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥ (ë¹„ì›Œë‘ë©´ ì „ì²´)">
            </div>
            <div style="margin-bottom:25px; text-align:left;">
                <div style="font-size:12px; font-weight:800; color:var(--sub); margin-bottom:12px; letter-spacing:1px;">ì¥ë¥´ í•„í„°</div>
                <div id="randGenreList" class="rand-list-wrapper"></div>
            </div>
            <div style="margin-bottom:25px; text-align:left;">
                <div style="font-size:12px; font-weight:800; color:var(--sub); margin-bottom:12px; letter-spacing:1px;">ê°€ìˆ˜ í•„í„°</div>
                <div id="randArtistList" class="rand-list-wrapper" style="max-height: 200px;"></div>
            </div>
            <button onclick="executeRandom()" class="random-btn" style="margin-bottom: 0;">ğŸ¯ ì„ íƒí•œ ë²”ìœ„ ë‚´ì—ì„œ ë½‘ê¸°</button>
        </div>
    </div>

    <div id="customModalOverlay">
        <div class="custom-modal-box">
            <div id="customModalTitle" class="custom-modal-title"></div>
            <div id="customModalMsg" class="custom-modal-msg"></div>
            <input type="text" id="customModalInput" class="custom-modal-input">
            <div class="custom-modal-btns">
                <button id="customModalCancelBtn" class="custom-modal-btn" style="background:rgba(255,255,255,0.05); color:var(--sub);">ì·¨ì†Œ</button>
                <button id="customModalConfirmBtn" class="custom-modal-btn" style="background:var(--accent); color:white; margin-left:12px;">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div id="memoToast" class="toast">ë“±ë¡ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.</div>

    <div id="adminOverlay" class="admin-overlay" onclick="closeAdmin()">
        <div class="admin-modal" onclick="event.stopPropagation()">
            <h2 id="adminTitle" style="margin-top:0; font-weight:900; letter-spacing:-1px;">TRACK EDITOR</h2>
            <div style="background:rgba(255,255,255,0.03); padding:25px; border-radius:25px; margin-bottom:25px; border: 1px dashed var(--accent);">
                <div style="display:flex; gap:10px;">
                    <input type="text" id="helperInput" style="flex:1; padding:15px; border-radius:15px; background:var(--input-bg); border:1px solid var(--line); color:white;" placeholder="ì œëª© - ê°€ìˆ˜ ì…ë ¥">
                    <button type="button" class="sns-link soop-btn" style="width:auto; padding:0 20px;" onclick="searchBugs()">ë²…ìŠ¤</button>
                    <button type="button" class="sns-link" style="background:#ff0000; width:auto; padding:0 20px;" onclick="searchYT()">ìœ íŠœë¸Œ</button>
                    <button type="button" style="background:var(--sub); color:white; border:none; padding:10px 15px; border-radius:12px; font-weight:800; cursor:pointer;" onclick="fillTemplate()">ì–‘ì‹</button>
                </div>
            </div>
            <div class="status-selector" style="display:flex; gap:10px; margin-bottom:25px;">
                <button type="button" class="status-btn active" onclick="setStatus('ì™„ê³¡')">ì™„ê³¡</button>
                <button type="button" class="status-btn" onclick="setStatus('1ì ˆ')">1ì ˆ</button>
                <button type="button" class="status-btn" onclick="setStatus('ê¸°íƒ€')">ê¸°íƒ€</button>
                <input type="hidden" id="f_status" value="ì™„ê³¡">
            </div>
            <textarea id="f_bulk_input" rows="12"></textarea>
            <div style="display:flex; gap:15px;">
                <input type="hidden" id="edit_id"> <button onclick="submitData()" class="random-btn" style="flex:2; margin-bottom:0; background:var(--accent);">UPDATE DATA</button>
                <button onclick="closeAdmin()" class="icon-btn" style="flex:1; width:auto; border:none; background:rgba(255,255,255,0.05);">CLOSE</button>
            </div>
        </div>
    </div>

    <div class="main-layout">
        <aside>
            <div class="side-card">
                <div style="font-size: 10px; color: var(--sub); margin-bottom: 8px; font-weight: 800; letter-spacing: 1px;">TOTAL COLLECTION</div>
                <div style="font-size: 32px; font-weight: 900; letter-spacing: -1.5px;"><span id="totalCount">0</span></div>
            </div>
            <button onclick="resetFilters()" style="width:100%; padding:14px; background:var(--card); color:var(--text); border:1px solid var(--line); border-radius:18px; cursor:pointer; font-weight:800; margin-bottom:15px; transition:0.3s;">ğŸ”„ RESET</button>
            <button onclick="openRandomModal()" class="random-btn">ğŸ² RANDOM PICK</button>
            <h3>GENRE</h3><div id="categoryFilters" class="filter-list"></div>
            <h3>ARTIST</h3><div id="artistFilters" class="filter-list"></div>
        </aside>
        <div style="flex-grow: 1;"><div class="song-grid" id="mainGrid"></div></div>
    </div>
    <footer><p>Â© 2026 JEY. ALL TRACKS CURATED FOR THE VIBE. (base77data@gmail.com)</p></footer>
</div>

<div id="modal" class="modal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <button class="close-btn" onclick="closeModal()">Ã—</button>
        <div id="modalSide"></div>
        <div class="lyrics-area">
            <div class="lyrics-control">
                <input type="number" id="lineCount" value="2" min="1" oninput="updateLyrics()" class="input-num">
                <span style="font-weight:800; font-size:14px; margin-right:20px;">ì¤„ì”© ë³´ê¸°</span>
                <div style="display:flex; gap:10px; margin-left:auto;">
                    <button class="p-btn active" onclick="setPerson(1, this)">1ì¸</button>
                    <button class="p-btn" onclick="setPerson(2, this)">2ì¸</button>
                    <button class="p-btn" onclick="setPerson(3, this)">3ì¸</button>
                </div>
            </div>
            <div id="lyricsDisplay" class="lyrics-display"></div>
            <div id="modalBtnArea" class="modal-btn-group"></div>
        </div>
    </div>
</div>

<script>
    // [1] ì´ˆê¸°í™” ë° ìºì‹œ ì—”ì§„
    const ADMIN_PW = "1234";
    const firebaseConfig = { apiKey: "AIzaSyAWAe1oGCH3-bT97fZyB8qW_hFE5aOT9BE", authDomain: "jey-songbook-1369e.firebaseapp.com", projectId: "jey-songbook-1369e", storageBucket: "jey-songbook-1369e.firebasestorage.app", messagingSenderId: "541154865578", appId: "1:541154865578:web:1a71c78e9d0b7eefa7bbd3" };
    firebase.initializeApp(firebaseConfig); const db = firebase.firestore();

    let allSongs = [], songDataList = {}, selectedCategory = 'ì „ì²´', selectedArtist = 'ì „ì²´', isAdmin = false, currentMemo = "";
    let currentLyrics = "", currentPersonCount = 1, filteredSongs = [], themeState = 0;
    let randSelGenre = 'ì „ì²´', randSelArtist = 'ì „ì²´';

    // [ì¤‘ìš”] ë¹ ë¥¸ ë¡œë”©ì„ ìœ„í•œ ë¡œì»¬ ìºì‹œ ì‚¬ìš©
    const cachedData = localStorage.getItem('jey_songs');
    if(cachedData) {
        allSongs = JSON.parse(cachedData);
        allSongs.forEach(s => songDataList[s.id] = s);
        setTimeout(() => {
            document.getElementById('totalCount').innerText = allSongs.length;
            document.getElementById('pageLoader').style.opacity = '0';
            setTimeout(() => { document.getElementById('pageLoader').style.display = 'none'; }, 600);
            document.getElementById('mainContainer').style.visibility = 'visible';
            updateFilterUI(); handleSearch();
        }, 100);
    }

    // ê°€ìˆ˜ ì´ë¦„ ë¶„ë¦¬ ë¡œì§ (íŠ¹ìˆ˜ë¬¸ì ë° ê¸°í˜¸ ì •ë°€ í•„í„°ë§)
    function getSplitArtists(str) {
        if(!str) return [];
        // ê³µë°±ì„ í¬í•¨í•œ xë‚˜ &ë§Œ ìª¼ê°œê³  ë‹¨ì–´ ì•ˆì˜ x(EXO, f(x))ëŠ” ë³´í˜¸í•¨
        return str.split(/\s*(?:&|,|feat\.|Feat\.|ft\.|(?:\s+x\s+)|(?:\s+\+\s+))\s*/i)
            .map(a => a.trim())
            .filter(a => a.length >= 2 && !/^[^a-zA-Z0-9ê°€-í£()]+$/.test(a)); 
    }

    // ì ‘ì† ì‹œ ë©”ì¸ í™”ë©´ ëœë¤ ì…”í”Œ í•¨ìˆ˜
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // ë©”ëª¨ ì‹¤ì‹œê°„ ê°ì‹œ
    db.collection("settings").doc("memo").onSnapshot(doc => { if(doc.exists) currentMemo = doc.data().text || ""; });

    // [2] ì»¤ìŠ¤í…€ ëª¨ë‹¬ í•¸ë“¤ëŸ¬ (ë¸Œë¼ìš°ì € ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ ë°©ì§€)
    let mCb = null;
    function showCustomModal(type, title, message, callback = null) {
        mCb = callback;
        const ov = document.getElementById('customModalOverlay');
        const inp = document.getElementById('customModalInput');
        document.getElementById('customModalTitle').innerText = title;
        document.getElementById('customModalMsg').innerText = message;
        inp.value = ''; inp.style.display = type === 'prompt' ? 'block' : 'none';
        document.getElementById('customModalCancelBtn').style.display = type !== 'alert' ? 'block' : 'none';
        ov.style.display = 'flex'; if (type === 'prompt') inp.focus();
    }
    document.getElementById('customModalConfirmBtn').onclick = () => { 
        const val = document.getElementById('customModalInput').value;
        document.getElementById('customModalOverlay').style.display = 'none'; 
        if (mCb) mCb(val || true); 
    };
    document.getElementById('customModalCancelBtn').onclick = () => { document.getElementById('customModalOverlay').style.display = 'none'; if (mCb) mCb(null); };

    // [3] ëœë¤ ê¸°ëŠ¥ (ì¹© UI ì—°ë™)
    function openRandomModal() {
        randSelGenre = 'ì „ì²´'; randSelArtist = 'ì „ì²´';
        document.getElementById('randKeyword').value = "";
        const genres = ['ì „ì²´', ...new Set(allSongs.map(s => s.genre).filter(Boolean))];
        const artSet = new Set(); allSongs.forEach(s => getSplitArtists(s.artist).forEach(a => artSet.add(a)));
        const artists = ['ì „ì²´', ...Array.from(artSet).sort((a,b) => a.localeCompare(b, 'ko'))];

        document.getElementById('randGenreList').innerHTML = genres.map(g => `<div class="rand-chip ${g==='ì „ì²´'?'active':''}" onclick="selRF('genre', '${g}', this)">${g}</div>`).join('');
        document.getElementById('randArtistList').innerHTML = artists.map(a => `<div class="rand-chip ${a==='ì „ì²´'?'active':''}" onclick="selRF('artist', '${a}', this)">${a}</div>`).join('');
        document.getElementById('randomFilterModal').style.display = 'flex';
    }
    function selRF(t, v, e) {
        e.parentElement.querySelectorAll('.rand-chip').forEach(c => c.classList.remove('active'));
        e.classList.add('active'); if(t === 'genre') randSelGenre = v; else randSelArtist = v;
    }
    function closeRandomModal() { document.getElementById('randomFilterModal').style.display = 'none'; }
    function executeRandom() {
        const key = document.getElementById('randKeyword').value.toLowerCase();
        let pool = allSongs;
        if(key) pool = pool.filter(s => s.title.toLowerCase().includes(key) || s.artist.toLowerCase().includes(key));
        if(randSelGenre !== 'ì „ì²´') pool = pool.filter(s => s.genre === randSelGenre);
        if(randSelArtist !== 'ì „ì²´') pool = pool.filter(s => s.artist.includes(randSelArtist));

        if(pool.length === 0) return showCustomModal('alert', '!', "í•´ë‹¹ë˜ëŠ” ë…¸ë˜ê°€ ì—†ìŠµë‹ˆë‹¤.");
        closeRandomModal();
        const ov = document.getElementById('rouletteOverlay'); ov.style.display = 'flex';
        let count = 0;
        const interval = setInterval(() => {
            const temp = pool[Math.floor(Math.random() * pool.length)];
            document.getElementById('rouletteImg').src = temp.imgUrl || 'https://via.placeholder.com/250';
            document.getElementById('rouletteTitle').innerText = temp.title;
            document.getElementById('rouletteArtist').innerText = temp.artist;
            if (++count > 25) { clearInterval(interval); setTimeout(() => { ov.style.display = 'none'; openPop(temp.id); }, 800); }
        }, 110);
    }

    // [4] í•„í„°ë§ ë° ê²€ìƒ‰ í•¸ë“¤ëŸ¬
    function handleSearch() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        filteredSongs = allSongs.filter(s => {
            const mS = (s.title + s.artist + (s.genre||'')).toLowerCase().includes(term);
            const mC = selectedCategory === 'ì „ì²´' || s.genre === selectedCategory;
            const mA = selectedArtist === 'ì „ì²´' || s.artist.includes(selectedArtist);
            return mS && mC && mA;
        });
        renderGrid();
    }

    function renderGrid() {
        const g = document.getElementById('mainGrid');
        g.innerHTML = filteredSongs.map(s => `
            <div class="song-card" onclick="openPop('${s.id}')">
                <div class="edit-btn-group">
                    <div class="edit-label" onclick="event.stopPropagation(); openAdmin('${s.id}')">ìˆ˜ì •</div>
                    <div class="edit-label" style="background:#ef4444; color:white;" onclick="event.stopPropagation(); deleteSong('${s.id}')">ì‚­ì œ</div>
                </div>
                <div class="art-box"><img src="${s.imgUrl || 'https://via.placeholder.com/200'}" onerror="this.src='https://via.placeholder.com/200?text=No+Image'"></div>
                <div class="info">
                    <span class="title-row">${s.title}</span>
                    <div class="sub-row"><span class="card-artist">${s.artist}</span><div class="badge-group"><span class="card-badge">${s.genre || 'ê¸°íƒ€'}</span><span class="card-badge ${s.status === 'ì™„ê³¡' ? 'bg-status' : ''}">${s.status || 'ì™„ê³¡'}</span></div></div>
                </div>
            </div>
        `).join('');
    }

    function updateFilterUI() {
        const genres = ['ì „ì²´', ...new Set(allSongs.map(s => s.genre).filter(Boolean))];
        document.getElementById('categoryFilters').innerHTML = genres.map(g => `<div class="filter-item ${selectedCategory===g?'active':''}" onclick="selectedCategory='${g}'; handleSearch(); updateFilterUI();">${g}</div>`).join('');
        const artSet = new Set(); allSongs.forEach(s => getSplitArtists(s.artist).forEach(a => artSet.add(a)));
        const artists = ['ì „ì²´', ...Array.from(artSet).sort((a,b) => a.localeCompare(b, 'ko'))];
        document.getElementById('artistFilters').innerHTML = artists.map(a => `<div class="filter-item ${selectedArtist===a?'active':''}" onclick="selectedArtist='${a}'; handleSearch(); updateFilterUI();">${a}</div>`).join('');
    }

    // [5] ìƒì„¸ íŒì—… ë° ê°€ì‚¬ (ì¦‰ì‹œ í‘œì‹œ)
    function openPop(id) {
        const s = songDataList[id]; if(!s) return;
        currentLyrics = s.lyrics || "";
        document.getElementById('modalSide').innerHTML = `
            <div style="width:100%; max-width:300px; margin:0 auto 25px; aspect-ratio:1; border-radius:30px; overflow:hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.6);"><img src="${s.imgUrl}" style="width:100%; height:100%; object-fit:cover;" onerror="this.src='https://via.placeholder.com/300?text=No+Image'"></div>
            <div style="font-size:30px; font-weight:900; margin-bottom:10px; color:white; line-height:1.2;">${s.title}</div>
            <div style="font-size:18px; color:var(--sub); margin-bottom:25px; font-weight:700;">${s.artist}</div>
            <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:24px; font-size:15px; line-height:2.2; border:1px solid var(--line); text-align:left;">
                <div style="display:flex; justify-content:space-between;"><span>ë¬´ë“œ/ì¥ë¥´</span> <span class="card-badge">${s.genre || '-'}</span></div>
                <div style="display:flex; justify-content:space-between; margin-top:5px;"><span>ë§ˆìŠ¤í„°ë§</span> <span>${s.status || 'ì™„ê³¡'}</span></div>
                <div style="display:flex; justify-content:space-between; margin-top:5px;"><span>í”¼ì¹˜/Key</span> <span>${s.key || 'N/A'}</span></div>
            </div>
        `;
        document.getElementById('modalBtnArea').innerHTML = `
            ${s.clipUrl ? `<a href="${s.clipUrl}" target="_blank" class="link-btn" style="background:#3b82f6;">MUSIC CLIP</a>` : ''}
            ${s.audioLyricsUrl ? `<a href="${s.audioLyricsUrl}" target="_blank" class="link-btn" style="background:#8b5cf6;">AUDIO VIBE</a>` : ''}
            ${s.karaokeUrl ? `<a href="${s.karaokeUrl}" target="_blank" class="link-btn" style="background:#f59e0b;">KARAOKE</a>` : ''}
            ${s.lyricsLink ? `<a href="${s.lyricsLink}" target="_blank" class="link-btn" style="background:#10b981;">SOURCE</a>` : ''}
        `;
        setPerson(1); document.getElementById('modal').style.display = 'flex'; updateLyrics();
    }
    function updateLyrics() {
        const u = parseInt(document.getElementById('lineCount').value) || 2;
        const l = currentLyrics.split('\n').filter(x => x.trim() !== "");
        document.getElementById('lyricsDisplay').innerHTML = l.length > 0 ? l.map((x, i) => `<div class="p${(Math.floor(i/u)%currentPersonCount)+1}">${x}</div>`).join('') : "<div style='color:var(--sub); text-align:center;'>ê°€ì‚¬ ì •ë³´ê°€ ì—…ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>";
    }

    // [6] ìˆ˜ì • ê¸°ëŠ¥ ì™„ë²½ ë³µêµ¬ (ID ì¶”ì  ë° Update ë¡œì§)
    function openAdmin(id = null) {
        document.getElementById('adminOverlay').style.display = 'flex';
        const inputArea = document.getElementById('f_bulk_input');
        if(id) {
            const s = songDataList[id]; document.getElementById('edit_id').value = id;
            document.getElementById('adminTitle').innerText = "TRACK INFO EDIT";
            inputArea.value = `ì œëª©: ${s.title}\nê°€ìˆ˜: ${s.artist}\nì¥ë¥´: ${s.genre||''}\ní‚¤: ${s.key||''}\nì´ë¯¸ì§€: ${s.imgUrl}\nìœ íŠœë¸Œ ë§í¬: ${s.clipUrl||''}\nê°€ì‚¬ì›ë¬¸ ë§í¬: ${s.lyricsLink||''}\nê°€ì‚¬ë§í¬: ${s.lyricsLink||''}\nìŒì›+ê°€ì‚¬ ë§í¬: ${s.audioLyricsUrl||''}\në…¸ë˜ë°© ë§í¬: ${s.karaokeUrl||''}\nê°€ì‚¬:\n${s.lyrics}`;
            setStatus(s.status || 'ì™„ê³¡');
        } else {
            document.getElementById('edit_id').value = ""; document.getElementById('adminTitle').innerText = "ADD NEW TRACK";
            inputArea.value = ""; fillTemplate(); setStatus('ì™„ê³¡');
        }
    }
    function submitData() {
        const editId = document.getElementById('edit_id').value;
        const bText = document.getElementById('f_bulk_input').value;
        const data = { lyrics: "", status: document.getElementById('f_status').value, createdAt: firebase.firestore.FieldValue.serverTimestamp() };
        bText.split('\n').forEach(l => {
            const r = l.trim();
            if(r.startsWith('ì œëª©:')) data.title = r.replace('ì œëª©:','').trim();
            else if(r.startsWith('ê°€ìˆ˜:')) data.artist = r.replace('ê°€ìˆ˜:','').trim();
            else if(r.startsWith('ì¥ë¥´:')) data.genre = r.replace('ì¥ë¥´:','').trim();
            else if(r.startsWith('í‚¤:')) data.key = r.replace('í‚¤:','').trim();
            else if(r.startsWith('ì´ë¯¸ì§€:')) data.imgUrl = r.replace('ì´ë¯¸ì§€:','').trim();
            else if(r.startsWith('ìœ íŠœë¸Œ ë§í¬:')) data.clipUrl = r.replace('ìœ íŠœë¸Œ ë§í¬:','').trim();
            else if(r.startsWith('ê°€ì‚¬ì›ë¬¸ ë§í¬:')) data.lyricsLink = r.replace('ê°€ì‚¬ì›ë¬¸ ë§í¬:','').trim();
            else if(r.startsWith('ìŒì›+ê°€ì‚¬ ë§í¬:')) data.audioLyricsUrl = r.replace('ìŒì›+ê°€ì‚¬ ë§í¬:','').trim();
            else if(r.startsWith('ë…¸ë˜ë°© ë§í¬:')) data.karaokeUrl = r.replace('ë…¸ë˜ë°© ë§í¬:','').trim();
            else if(r.startsWith('ê°€ì‚¬:')) { data.isL = true; const f = l.split('ê°€ì‚¬:')[1]?.trim(); if(f) data.lyrics += f + '\n'; }
            else if(data.isL) data.lyrics += l + '\n';
        });
        if(!data.title) return showCustomModal('alert', '!', "ì œëª©ì€ í•„ìˆ˜ ì…ë ¥ ì‚¬í•­ì…ë‹ˆë‹¤.");
        const ref = db.collection("songs");
        const action = editId ? ref.doc(editId).set(data, {merge: true}) : ref.add(data);
        action.then(() => { showCustomModal('alert', 'DONE', editId ? "ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!" : "ìƒˆë¡œìš´ ë…¸ë˜ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!"); closeAdmin(); });
    }

    // [7] ì‹¤ì‹œê°„ ë°ì´í„° ë¡œë“œ (0ê³¡ ë° ì…”í”Œ ì²˜ë¦¬)
    db.collection("songs").orderBy("createdAt", "desc").onSnapshot(snap => {
        let raw = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        // ìºì‹œ ì—…ë°ì´íŠ¸ ë° ì´ˆê¸° ë¬´ì‘ìœ„ ë°°ì¹˜
        allSongs = shuffleArray([...raw]);
        localStorage.setItem('jey_songs', JSON.stringify(allSongs));
        allSongs.forEach(s => songDataList[s.id] = s);
        
        document.getElementById('totalCount').innerText = allSongs.length;
        document.getElementById('pageLoader').style.opacity = '0';
        setTimeout(() => { document.getElementById('pageLoader').style.display = 'none'; }, 600);
        document.getElementById('mainContainer').style.visibility = 'visible';
        updateFilterUI(); handleSearch();
    });

    // ê¸°íƒ€ ê¸°ëŠ¥ (í…Œë§ˆ, ë©”ëª¨ ë“±)
    async function deleteSong(id) { showCustomModal('confirm', 'DELETE', "ì •ë§ë¡œ ì´ ë…¸ë˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?", async (c) => { if(c === true) await db.collection("songs").doc(id).delete(); }); }
    function closeAdmin() { document.getElementById('adminOverlay').style.display = 'none'; document.getElementById('edit_id').value = ""; }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    function resetFilters() { selectedCategory = 'ì „ì²´'; selectedArtist = 'ì „ì²´'; document.getElementById('searchInput').value = ""; handleSearch(); updateFilterUI(); }
    function cycleTheme() {
        themeState = (themeState + 1) % 2;
        const h = document.documentElement; const b = document.getElementById('themeCycleBtn');
        if (themeState === 0) { h.removeAttribute('data-theme'); b.innerText = "â˜€ï¸"; }
        else { h.setAttribute('data-theme', 'light'); b.innerText = "ğŸŒ™"; }
    }
    function toggleAdminMode() {
        if (!isAdmin) { showCustomModal('prompt', 'ì¸ì¦', "ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:", (p) => { if (p === ADMIN_PW) { isAdmin = true; document.body.classList.add('admin-mode'); document.getElementById('adminToggle').classList.add('active'); document.getElementById('addBtn').style.display = "block"; renderGrid(); } }); }
        else { isAdmin = false; document.body.classList.remove('admin-mode'); document.getElementById('adminToggle').classList.remove('active'); document.getElementById('addBtn').style.display = "none"; renderGrid(); }
    }
    function handleMemoClick() {
        if(isAdmin) { showCustomModal('prompt', 'EDIT MEMO', "ê³µì§€í•  ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”:", (m) => { if(m && m !== true) db.collection("settings").doc("memo").set({ text: m }); }); }
        else { const t = document.getElementById('memoToast'); t.innerText = currentMemo || "ë“±ë¡ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤."; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 3000); }
    }
    function searchBugs() { const q = document.getElementById('helperInput').value; if(!q) return showCustomModal('alert', '!', "ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”!"); window.open(`https://music.bugs.co.kr/search/track?q=${encodeURIComponent(q)}`, '_blank'); }
    function searchYT() { const q = document.getElementById('helperInput').value; if(!q) return showCustomModal('alert', '!', "ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”!"); window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`, '_blank'); }
    function fillTemplate() { document.getElementById('f_bulk_input').value = "ì œëª©: \nê°€ìˆ˜: \nì¥ë¥´: \ní‚¤: \nì´ë¯¸ì§€: \nìœ íŠœë¸Œ ë§í¬: \nê°€ì‚¬ì›ë¬¸ ë§í¬: \nìŒì›+ê°€ì‚¬ ë§í¬: \në…¸ë˜ë°© ë§í¬: \nê°€ì‚¬: "; }
    function setPerson(n, b = null) { currentPersonCount = n; if(b) { document.querySelectorAll('.p-btn').forEach(x => x.classList.remove('active')); b.classList.add('active'); } updateLyrics(); }
    function setStatus(v) { document.getElementById('f_status').value = v; document.querySelectorAll('.status-btn').forEach(x => { if(x.innerText === v) x.classList.add('active'); else x.classList.remove('active'); }); }
</script>
</body>
</html>
